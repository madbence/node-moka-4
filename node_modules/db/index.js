module.exports = function(client) {
	var mongo = require('mongodb');
	var db = new mongo.Db('moka', new mongo.Server('localhost', 27017), {
		w: 1
	});
	db.open(function(err, dbref) {
		if(err) {
			return console.log(err);
		}
		db = dbref;
	});
	client.db = {
		find: function(coll, cond, f) {
			db.collection(coll, function(err, coll) {
				if(err) {
					return f(err);
				}
				coll.find(cond, function(err, cur) {
					if(err) {
						return f(err);
					}
					cur.toArray(f);
				})
			})
		},
		findOne: function(coll, cond, f) {
			db.collection(coll, function(err, coll) {
				if(err) {
					return f(err);
				}
				coll.findOne(cond,f);
			})
		},
		update: function(coll, cond, set, f) {
			db.collection(coll, function(err, coll) {
				if(err) {
					return f(err);
				}
				coll.update(cond, set, {
					w: 1
				}, f);
			})
		},
		insert: function(coll, obj, f) {
			db.collection(coll, function(err, coll) {
				if(err) {
					return f(err);
				}
				coll.insert(obj, {
					w: 1
				}, f);
			})
		},
		upsert: function(coll,cond,up,ins,f){
			client.db.findOne(coll,cond,function(err,res){
				if(err){
					return f(err);
				}
				if(!res){
					return client.db.insert(coll,ins,f);
				}
				client.db.update(coll,cond,up,function(err,n){
					if(err) return f(err);
					f(err,res,true);
				});
			})
		}
	}
}